// iPhone Data - All models from iPhone X onwards
// Dimensions in mm, screen diagonal in inches
const iPhoneData = {
    // iPhone X Series (2017-2018)
    'iphone-x': {
        name: 'iPhone X',
        height: 143.6,
        width: 70.9,
        depth: 7.7,
        screenDiagonal: 5.8,
        screenToBodyRatio: 82.9
    },
    'iphone-xr': {
        name: 'iPhone XR',
        height: 150.9,
        width: 75.7,
        depth: 8.3,
        screenDiagonal: 6.1,
        screenToBodyRatio: 79.0
    },
    'iphone-xs': {
        name: 'iPhone XS',
        height: 143.6,
        width: 70.9,
        depth: 7.7,
        screenDiagonal: 5.8,
        screenToBodyRatio: 82.9
    },
    'iphone-xs-max': {
        name: 'iPhone XS Max',
        height: 157.5,
        width: 77.4,
        depth: 7.7,
        screenDiagonal: 6.5,
        screenToBodyRatio: 84.4
    },

    // iPhone 11 Series (2019)
    'iphone-11': {
        name: 'iPhone 11',
        height: 150.9,
        width: 75.7,
        depth: 8.3,
        screenDiagonal: 6.1,
        screenToBodyRatio: 79.0
    },
    'iphone-11-pro': {
        name: 'iPhone 11 Pro',
        height: 144.0,
        width: 71.4,
        depth: 8.1,
        screenDiagonal: 5.8,
        screenToBodyRatio: 82.1
    },
    'iphone-11-pro-max': {
        name: 'iPhone 11 Pro Max',
        height: 158.0,
        width: 77.8,
        depth: 8.1,
        screenDiagonal: 6.5,
        screenToBodyRatio: 84.0
    },

    // iPhone 12 Series (2020)
    'iphone-12-mini': {
        name: 'iPhone 12 mini',
        height: 131.5,
        width: 64.2,
        depth: 7.4,
        screenDiagonal: 5.4,
        screenToBodyRatio: 85.1
    },
    'iphone-12': {
        name: 'iPhone 12',
        height: 146.7,
        width: 71.5,
        depth: 7.4,
        screenDiagonal: 6.1,
        screenToBodyRatio: 86.0
    },
    'iphone-12-pro': {
        name: 'iPhone 12 Pro',
        height: 146.7,
        width: 71.5,
        depth: 7.4,
        screenDiagonal: 6.1,
        screenToBodyRatio: 86.0
    },
    'iphone-12-pro-max': {
        name: 'iPhone 12 Pro Max',
        height: 160.8,
        width: 78.1,
        depth: 7.4,
        screenDiagonal: 6.7,
        screenToBodyRatio: 87.4
    },

    // iPhone 13 Series (2021)
    'iphone-13-mini': {
        name: 'iPhone 13 mini',
        height: 131.5,
        width: 64.2,
        depth: 7.7,
        screenDiagonal: 5.4,
        screenToBodyRatio: 85.1
    },
    'iphone-13': {
        name: 'iPhone 13',
        height: 146.7,
        width: 71.5,
        depth: 7.7,
        screenDiagonal: 6.1,
        screenToBodyRatio: 86.0
    },
    'iphone-13-pro': {
        name: 'iPhone 13 Pro',
        height: 146.7,
        width: 71.5,
        depth: 7.7,
        screenDiagonal: 6.1,
        screenToBodyRatio: 86.0
    },
    'iphone-13-pro-max': {
        name: 'iPhone 13 Pro Max',
        height: 160.8,
        width: 78.1,
        depth: 7.7,
        screenDiagonal: 6.7,
        screenToBodyRatio: 87.4
    },

    // iPhone 14 Series (2022)
    'iphone-14': {
        name: 'iPhone 14',
        height: 146.7,
        width: 71.5,
        depth: 7.8,
        screenDiagonal: 6.1,
        screenToBodyRatio: 86.0
    },
    'iphone-14-plus': {
        name: 'iPhone 14 Plus',
        height: 160.8,
        width: 78.1,
        depth: 7.8,
        screenDiagonal: 6.7,
        screenToBodyRatio: 87.4
    },
    'iphone-14-pro': {
        name: 'iPhone 14 Pro',
        height: 147.5,
        width: 71.5,
        depth: 7.9,
        screenDiagonal: 6.1,
        screenToBodyRatio: 86.6
    },
    'iphone-14-pro-max': {
        name: 'iPhone 14 Pro Max',
        height: 160.7,
        width: 77.6,
        depth: 7.9,
        screenDiagonal: 6.7,
        screenToBodyRatio: 88.3
    },

    // iPhone 15 Series (2023)
    'iphone-15': {
        name: 'iPhone 15',
        height: 147.6,
        width: 71.6,
        depth: 7.8,
        screenDiagonal: 6.1,
        screenToBodyRatio: 86.4
    },
    'iphone-15-plus': {
        name: 'iPhone 15 Plus',
        height: 160.9,
        width: 77.8,
        depth: 7.8,
        screenDiagonal: 6.7,
        screenToBodyRatio: 87.9
    },
    'iphone-15-pro': {
        name: 'iPhone 15 Pro',
        height: 146.6,
        width: 70.6,
        depth: 8.3,
        screenDiagonal: 6.1,
        screenToBodyRatio: 87.9
    },
    'iphone-15-pro-max': {
        name: 'iPhone 15 Pro Max',
        height: 159.9,
        width: 76.7,
        depth: 8.3,
        screenDiagonal: 6.7,
        screenToBodyRatio: 89.0
    },

    // iPhone 16 Series (2024)
    'iphone-16': {
        name: 'iPhone 16',
        height: 147.6,
        width: 71.6,
        depth: 7.8,
        screenDiagonal: 6.1,
        screenToBodyRatio: 87.0
    },
    'iphone-16-plus': {
        name: 'iPhone 16 Plus',
        height: 160.9,
        width: 77.8,
        depth: 7.8,
        screenDiagonal: 6.7,
        screenToBodyRatio: 88.0
    },
    'iphone-16-pro': {
        name: 'iPhone 16 Pro',
        height: 149.6,
        width: 71.5,
        depth: 8.3,
        screenDiagonal: 6.3,
        screenToBodyRatio: 88.5
    },
    'iphone-16-pro-max': {
        name: 'iPhone 16 Pro Max',
        height: 163.0,
        width: 77.6,
        depth: 8.3,
        screenDiagonal: 6.9,
        screenToBodyRatio: 89.5
    },

    // iPhone 17 Series (2025)
    'iphone-17': {
        name: 'iPhone 17',
        height: 147.7,
        width: 71.5,
        depth: 7.8,
        screenDiagonal: 6.1,
        screenToBodyRatio: 87.5
    },
    'iphone-17-air': {
        name: 'iPhone 17 Air',
        height: 155.0,
        width: 69.0,
        depth: 5.5,
        screenDiagonal: 6.6,
        screenToBodyRatio: 89.0
    },
    'iphone-17-pro': {
        name: 'iPhone 17 Pro',
        height: 149.6,
        width: 71.5,
        depth: 8.3,
        screenDiagonal: 6.3,
        screenToBodyRatio: 89.0
    },
    'iphone-17-pro-max': {
        name: 'iPhone 17 Pro Max',
        height: 163.0,
        width: 77.6,
        depth: 8.3,
        screenDiagonal: 6.9,
        screenToBodyRatio: 90.0
    }
};

// Calculate body diagonal from dimensions (in mm, converted to inches for display)
function calculateBodyDiagonal(height, width) {
    const diagonalMm = Math.sqrt(height * height + width * width);
    const diagonalInches = diagonalMm / 25.4;
    return diagonalInches;
}

// DOM Elements
const phone1Select = document.getElementById('phone1');
const phone2Select = document.getElementById('phone2');
const phone3Select = document.getElementById('phone3');
const comparisonContainer = document.getElementById('comparisonContainer');
const showBezelsCheckbox = document.getElementById('showBezels');

// Populate dropdowns
function populateDropdowns() {
    const selects = [phone1Select, phone2Select, phone3Select];

    // Group phones by series for better organization
    const groups = [
        { label: 'iPhone 17 Series', phones: ['iphone-17', 'iphone-17-air', 'iphone-17-pro', 'iphone-17-pro-max'] },
        { label: 'iPhone 16 Series', phones: ['iphone-16', 'iphone-16-plus', 'iphone-16-pro', 'iphone-16-pro-max'] },
        { label: 'iPhone 15 Series', phones: ['iphone-15', 'iphone-15-plus', 'iphone-15-pro', 'iphone-15-pro-max'] },
        { label: 'iPhone 14 Series', phones: ['iphone-14', 'iphone-14-plus', 'iphone-14-pro', 'iphone-14-pro-max'] },
        { label: 'iPhone 13 Series', phones: ['iphone-13-mini', 'iphone-13', 'iphone-13-pro', 'iphone-13-pro-max'] },
        { label: 'iPhone 12 Series', phones: ['iphone-12-mini', 'iphone-12', 'iphone-12-pro', 'iphone-12-pro-max'] },
        { label: 'iPhone 11 Series', phones: ['iphone-11', 'iphone-11-pro', 'iphone-11-pro-max'] },
        { label: 'iPhone X Series', phones: ['iphone-x', 'iphone-xr', 'iphone-xs', 'iphone-xs-max'] }
    ];

    selects.forEach(select => {
        groups.forEach(group => {
            const optgroup = document.createElement('optgroup');
            optgroup.label = group.label;

            group.phones.forEach(phoneId => {
                const phone = iPhoneData[phoneId];
                const option = document.createElement('option');
                option.value = phoneId;
                option.textContent = phone.name;
                optgroup.appendChild(option);
            });

            select.appendChild(optgroup);
        });
    });
}

// Get selected phones
function getSelectedPhones() {
    const phones = [];
    const selects = [phone1Select, phone2Select, phone3Select];

    selects.forEach((select, index) => {
        if (select.value) {
            phones.push({
                ...iPhoneData[select.value],
                id: select.value,
                index: index
            });
        }
    });

    return phones;
}

// Render visual comparison
function renderComparison() {
    const phones = getSelectedPhones();

    if (phones.length === 0) {
        comparisonContainer.innerHTML = '<div class="no-selection">Select iPhone models to compare</div>';
        return;
    }

    // Clear container
    comparisonContainer.innerHTML = '';

    // Find the largest phone for scaling
    const maxHeight = Math.max(...phones.map(p => p.height));
    const maxWidth = Math.max(...phones.map(p => p.width));

    // Calculate scale to fit container (with padding)
    const containerHeight = comparisonContainer.clientHeight - 40;
    const containerWidth = comparisonContainer.clientWidth - 40;
    const scale = Math.min(containerHeight / maxHeight, containerWidth / maxWidth);

    // Render each phone
    phones.forEach(phone => {
        const phoneDiv = document.createElement('div');
        phoneDiv.className = `phone-visual phone-${phone.index + 1}`;

        const scaledHeight = phone.height * scale;
        const scaledWidth = phone.width * scale;

        phoneDiv.style.height = `${scaledHeight}px`;
        phoneDiv.style.width = `${scaledWidth}px`;

        // Calculate screen size based on screen-to-body ratio
        // Screen area is approximately screenToBodyRatio% of body area
        const screenRatio = Math.sqrt(phone.screenToBodyRatio / 100);
        const screenHeight = scaledHeight * screenRatio * 0.95; // Slightly smaller for visual effect
        const screenWidth = scaledWidth * screenRatio * 0.95;

        const screenDiv = document.createElement('div');
        screenDiv.className = 'screen-visual';
        screenDiv.style.height = `${screenHeight}px`;
        screenDiv.style.width = `${screenWidth}px`;

        phoneDiv.appendChild(screenDiv);

        // Add label
        const label = document.createElement('div');
        label.className = 'phone-label';
        label.textContent = phone.name;
        phoneDiv.appendChild(label);

        comparisonContainer.appendChild(phoneDiv);
    });
}

// Update comparison table
function updateTable() {
    const phones = getSelectedPhones();

    // Update headers and data for each slot
    for (let i = 0; i < 3; i++) {
        const phone = phones.find(p => p.index === i);
        const num = i + 1;

        // Update header
        document.getElementById(`header${num}`).textContent = phone ? phone.name : `Phone ${num}`;

        if (phone) {
            // Dimensions
            document.getElementById(`dims${num}`).textContent =
                `${phone.height} × ${phone.width} × ${phone.depth} mm`;

            // Body diagonal
            const bodyDiag = calculateBodyDiagonal(phone.height, phone.width);
            document.getElementById(`bodyDiag${num}`).textContent =
                `${bodyDiag.toFixed(2)}"`;

            // Screen diagonal
            document.getElementById(`screenDiag${num}`).textContent =
                `${phone.screenDiagonal}"`;

            // Screen-to-body ratio
            document.getElementById(`ratio${num}`).textContent =
                `${phone.screenToBodyRatio}%`;
        } else {
            document.getElementById(`dims${num}`).textContent = '-';
            document.getElementById(`bodyDiag${num}`).textContent = '-';
            document.getElementById(`screenDiag${num}`).textContent = '-';
            document.getElementById(`ratio${num}`).textContent = '-';
        }
    }
}

// Update all comparisons
function updateAll() {
    renderComparison();
    updateTable();
}

// Toggle bezel visibility
function toggleBezels() {
    if (showBezelsCheckbox.checked) {
        comparisonContainer.classList.remove('hide-bezels');
    } else {
        comparisonContainer.classList.add('hide-bezels');
    }
}

// Event listeners
phone1Select.addEventListener('change', updateAll);
phone2Select.addEventListener('change', updateAll);
phone3Select.addEventListener('change', updateAll);
showBezelsCheckbox.addEventListener('change', toggleBezels);

// Handle window resize
window.addEventListener('resize', renderComparison);

// Initialize
populateDropdowns();
updateAll();
